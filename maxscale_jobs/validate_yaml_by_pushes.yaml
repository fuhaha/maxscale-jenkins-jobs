- job:
    name: validate_yaml_by_pushes
    description: 'This job check maxscale-jobs repo content using validator triggered by pushes.'
    triggers:
      - github
    scm:
      - git:
          url: !include: './maxscale_jobs/include/maxscale_bsl_url.yaml'
          branches:
            - '*'
    builders:
      - shell: |
          jobs=`ls maxscale_jobs/*.yaml -1`
          res=0
          failed_list=""
          
          for job in $jobs
          do
            $HOME/jjg/jenkins_job_gitizer/scripts/validate_yaml.sh $job
            if [ $? != 0 ]; then
              echo "Validating of $job FAILED!"
              failed_list="$failed_list \n $job"
              res=1
            fi
          done

          if [ $res != 0 ]; then
            echo ""
            echo "Failed jobs:"
            echo -e $failed_list
          fi

          exit $res
    publishers:
        - email-ext:
            recipients: !include-raw: "./maxscale_jobs/include/mail_recipients.yaml"
            reply-to: $DEFAULT_REPLYTO
            content-type: default
            subject: $DEFAULT_SUBJECT
            body: $DEFAULT_CONTENT 
            attach-build-log: false
            aborted: true
            failure: true
            still-failing: true
            success: true
            fixed: true
            presend-script: $DEFAULT_PRESEND_SCRIPT
            send-to:
              - recipients
          