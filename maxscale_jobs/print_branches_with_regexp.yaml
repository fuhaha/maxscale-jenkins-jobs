- job:
    name: print_branches_with_regexp
    description: 'This job prints list of all branches from maxscale repo which match $pattern'
    parameters:
        - string:
            name: pattern
            default: master
        - string:
            name: repo
            default: github.com/mariadb-corporation/maxscale-jenkins-jobs.git
    builders:
        - shell: |
            branches_list=`git ls-remote --heads git://$repo | sed 's?.*refs/heads/??'`
            matches_list=""

            for line in $branches_list
            do
              if [ echo $line | grep -q $pattern ]; then
                matches_list+=($line)
              fi
            done
            
            if [ -z "$matches_list" ]; then
              echo "$pattern does not match any branches from $repo!"
              exit 1
            fi
            
            for branch_name in ${matches_list[@]} ; do
              echo $branch_name
            done
            exit 0
