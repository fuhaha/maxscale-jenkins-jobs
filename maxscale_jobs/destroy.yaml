- job:
    name: destroy
    description: 'This job destroys test setup'
    parameters:
      - !include: './maxscale_jobs/include/name.yaml'
      - !include: './maxscale_jobs/include/do_not_destroy_vm.yaml'
    builders:
      - shell: | 
          if [ $do_not_destroy_vm == "yes" ]; then
            echo "Config marked as undestroyable, exiting"
            exit 1
          fi
      - shell: |
          if [ -d "$HOME/mdbci/$name" ]; then
            cd $HOME/mdbci/$name
            vagrant destroy -f
            if [ "$?" -eq "1" ]; then
              ../scripts/clean_vms.sh ${name}
            fi
          else
            echo "Directory $HOME/mdbci/$name does not exist. Probably this job was called before $name configuration had created."
          fi 
